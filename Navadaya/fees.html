<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fees - Navadaya Girls Hostel</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-home"></i>
                <span>Navadaya Admin</span>
            </div>
            
            <ul class="sidebar-menu">
                <li>
                    <a href="dashboard.html">
                        <i class="fas fa-chart-bar"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="rooms.html">
                        <i class="fas fa-bed"></i>
                        <span>Rooms</span>
                    </a>
                </li>
                <li>
                    <a href="students.html">
                        <i class="fas fa-users"></i>
                        <span>Students</span>
                    </a>
                </li>
                <li class="active">
                    <a href="fees.html">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Fees</span>
                    </a>
                </li>
                <li>
                    <a href="notices.html">
                        <i class="fas fa-bullhorn"></i>
                        <span>Notices</span>
                    </a>
                </li>
                <li>
                    <a href="complaints.html">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>Complaints</span>
                    </a>
                </li>
                <li>
                    <a href="roomchangemanagement.html">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Room Changes</span>
                    </a>
                </li>
                <li>
                    <a href="leavemanagement.html">
                        <i class="fas fa-calendar-times"></i>
                        <span>Leave Applications</span>
                    </a>
                </li>
                <li>
                    <a href="roommaintenancerequests.html">
                        <i class="fas fa-tools"></i>
                        <span>Maintenance Requests</span>
                    </a>
                </li>
                <li>
                    <a href="receipt-verification.html">
                        <i class="fas fa-shield-alt"></i>
                        <span>Receipt Verification</span>
                    </a>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <button id="logoutBtn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>Fee Management</h1>
                <div class="header-actions">
                    <button id="debugBtn" class="btn-secondary" style="background: #17a2b8;">
                        <i class="fas fa-bug"></i>
                        Debug Info
                    </button>
                    <button id="generateFeesBtn" class="btn-secondary">
                        <i class="fas fa-calendar-plus"></i>
                        Generate Fees
                    </button>
                    <button id="viewReportsBtn" class="btn-secondary">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF Reports
                    </button>
                    <button id="recordPaymentBtn" class="btn-primary">
                        <i class="fas fa-plus"></i>
                        Record Payment
                    </button>
                </div>
            </header>

            <div class="content-body">
                <!-- Summary Cards -->
                <div class="fee-summary">
                    <div class="summary-card">
                        <div class="summary-icon teal">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="summary-info">
                            <h3 id="totalPaid">₹0</h3>
                            <p>Total Collected</p>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-icon yellow">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="summary-info">
                            <h3 id="totalPending">₹0</h3>
                            <p>Pending Dues</p>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-icon coral">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="summary-info">
                            <h3 id="overdueFees">₹0</h3>
                            <p>Overdue</p>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-section">
                    <div class="filter-group">
                        <select id="statusFilter">
                            <option value="">All Status</option>
                            <option value="paid">Paid</option>
                            <option value="pending">Pending</option>
                            <option value="overdue">Overdue</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <select id="monthFilter">
                            <option value="">All Months</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <select id="feeTypeFilter">
                            <option value="">All Types</option>
                            <option value="monthly_rent">Monthly Rent</option>
                            <option value="security_deposit">Security Deposit</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="electricity">Electricity</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <select id="roomFilter">
                            <option value="">All Rooms</option>
                        </select>
                    </div>
                    
                    <div class="search-group">
                        <input type="text" id="searchStudent" placeholder="Search student, roll number, or room...">
                        <i class="fas fa-search"></i>
                    </div>
                </div>

                <!-- Fee Records Table -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Room</th>
                                <th>Period/Type</th>
                                <th>Amount</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="feesTableBody">
                            <!-- Fee records will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <div id="emptyState" class="empty-state hidden">
                    <i class="fas fa-money-bill-wave"></i>
                    <h3>No fee records found</h3>
                    <p>Fee records will appear here</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="paymentModalTitle">Record Payment</h3>
                <button class="modal-close">&times;</button>
            </div>
            
            <form id="paymentForm">
                <div class="form-group">
                    <label for="studentSelect">Student</label>
                    <select id="studentSelect" name="studentSelect" required>
                        <option value="">Select Student</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="feeType">Fee Type</label>
                    <select id="feeType" name="feeType" required>
                        <option value="monthly_rent">Monthly Rent</option>
                        <option value="security_deposit">Security Deposit</option>
                        <option value="maintenance">Maintenance</option>
                        <option value="electricity">Electricity</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="month">Month</label>
                        <select id="month" name="month" required>
                            <option value="">Select Month</option>
                            <option value="01">January</option>
                            <option value="02">February</option>
                            <option value="03">March</option>
                            <option value="04">April</option>
                            <option value="05">May</option>
                            <option value="06">June</option>
                            <option value="07">July</option>
                            <option value="08">August</option>
                            <option value="09">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="year">Year</label>
                        <select id="year" name="year" required>
                            <option value="">Select Year</option>
                        </select>
                    </div>
                </div>
                


                <div class="form-group">
                    <label for="amount">Amount (₹)</label>
                    <input type="number" id="amount" name="amount" step="0.01" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="paymentDate">Payment Date</label>
                    <input type="date" id="paymentDate" name="paymentDate" required>
                </div>
                
                <div class="form-group">
                    <label for="paymentMethod">Payment Method</label>
                    <select id="paymentMethod" name="paymentMethod" required>
                        <option value="">Select Method</option>
                        <option value="cash">Cash</option>
                        <option value="upi">UPI</option>
                        <option value="bank_transfer">Bank Transfer</option>
                        <option value="cheque">Cheque</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="notes">Notes (Optional)</label>
                    <textarea id="notes" name="notes" rows="3"></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelPaymentBtn">Cancel</button>
                    <button type="submit" class="btn-primary">Record Payment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Advanced Fee Generation Modal -->
    <div id="advancedFeeModal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Generate Fees</h3>
                <button class="modal-close">&times;</button>
            </div>
            
            <form id="advancedFeeForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="advancedStartMonth">Start Month</label>
                        <select id="advancedStartMonth" name="startMonth" required>
                            <option value="01">January</option>
                            <option value="02">February</option>
                            <option value="03">March</option>
                            <option value="04">April</option>
                            <option value="05">May</option>
                            <option value="06">June</option>
                            <option value="07">July</option>
                            <option value="08">August</option>
                            <option value="09">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="advancedStartYear">Start Year</label>
                        <select id="advancedStartYear" name="startYear" required>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="advancedEndMonth">End Month</label>
                        <select id="advancedEndMonth" name="endMonth" required>
                            <option value="01">January</option>
                            <option value="02">February</option>
                            <option value="03">March</option>
                            <option value="04">April</option>
                            <option value="05">May</option>
                            <option value="06">June</option>
                            <option value="07">July</option>
                            <option value="08">August</option>
                            <option value="09">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="advancedEndYear">End Year</label>
                        <select id="advancedEndYear" name="endYear" required>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="advancedFeeType">Fee Type</label>
                    <select id="advancedFeeType" name="feeType" required>
                        <option value="monthly_rent">Monthly Rent</option>
                        <option value="maintenance">Maintenance</option>
                        <option value="electricity">Electricity</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="includeSecurityDeposit" name="includeSecurityDeposit">
                        Also generate security deposits for new students
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="feeManager.closeAdvancedFeeModal()">Cancel</button>
                    <button type="button" class="btn-primary" onclick="feeManager.generateAdvancedFees()">Generate Fees</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reports Modal -->
    <div id="reportsModal" class="modal hidden">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3>Fee Reports & Analytics</h3>
                <button class="modal-close">&times;</button>
            </div>
            
            <div class="reports-content">
                <div class="report-tabs">
                    <button class="tab-btn active" data-tab="overview">Overview</button>
                    <button class="tab-btn" data-tab="students">All Students</button>
                    <button class="tab-btn" data-tab="receipts">Receipts</button>
                </div>
                
                <div class="tab-content" id="overviewTab">
                    <div class="summary-cards">
                        <div class="summary-card">
                            <h4>Total Collections</h4>
                            <div class="amount" id="totalCollections">₹0</div>
                        </div>
                        <div class="summary-card">
                            <h4>Pending Dues</h4>
                            <div class="amount pending" id="pendingDues">₹0</div>
                        </div>
                        <div class="summary-card">
                            <h4>Overdue Amount</h4>
                            <div class="amount overdue" id="overdueAmount">₹0</div>
                        </div>
                        <div class="summary-card">
                            <h4>Security Deposits</h4>
                            <div class="amount" id="securityDeposits">₹0</div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content hidden" id="studentsTab">
                    <div id="studentsReportContent">Loading...</div>
                </div>
                
                <div class="tab-content hidden" id="receiptsTab">
                    <div class="receipts-section">
                        <h4>Generate Receipt</h4>
                        <div class="form-row">
                            <select id="receiptStudent">
                                <option value="">Select Student</option>
                            </select>
                            <select id="receiptPayment">
                                <option value="">Select Payment</option>
                            </select>
                            <button class="btn-primary" onclick="feeManager.generateReceipt()">Generate Receipt</button>
                        </div>
                    </div>
                    
                    <div id="receiptPreview" class="receipt-preview hidden">
                        <!-- Receipt will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Generation Modal -->
    <div id="reportModal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Generate Reports</h2>
                <span class="modal-close">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label>Report Type</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="reportType" value="student">
                            <span>Individual Student Report</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="reportType" value="all_students">
                            <span>All Students Report (Complete Info)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="reportType" value="fees" checked>
                            <span>Comprehensive Fees Report</span>
                        </label>
                    </div>
                </div>

                <!-- Student Report Options -->
                <div id="studentReportOptions" class="hidden">
                    <div class="form-group">
                        <label for="reportStudentSelect">Select Student</label>
                        <select id="reportStudentSelect">
                            <option value="">Choose a student...</option>
                        </select>
                    </div>
                </div>

                <!-- Fees Report Options -->
                <div id="feesReportOptions">
                    <h4>Filter Options (Optional)</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reportYear">Year</label>
                            <select id="reportYear">
                                <option value="">All Years</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportMonth">Month</label>
                            <select id="reportMonth">
                                <option value="">All Months</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reportStatus">Status</label>
                            <select id="reportStatus">
                                <option value="">All Status</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportFeeType">Fee Type</label>
                            <select id="reportFeeType">
                                <option value="">All Fee Types</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="reportManager.closeReportModal()">Cancel</button>
                <button type="button" class="btn-primary" onclick="reportManager.generateSelectedReport()">
                    <i class="fas fa-download"></i>
                    Generate & Download PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDA6duS8SJ5Wr26qNxzBoge01Leestj-9o",
            authDomain: "animal-planet-73497.firebaseapp.com",
            databaseURL: "https://animal-planet-73497-default-rtdb.firebaseio.com",
            projectId: "animal-planet-73497",
            storageBucket: "animal-planet-73497.appspot.com",
            messagingSenderId: "15025745338",
            appId: "1:15025745338:web:f2d2e2644d822afea00183",
            measurementId: "G-KP9582LMC3"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebase = { app, auth, db };
    </script>

    <script src="js/utils.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/fees.js"></script>
</body>
</html>
